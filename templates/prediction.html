{% extends 'base.html' %}
{% block title %} Sunset Prediction {% endblock %}
{% block style %}

<style type="text/css">

    #map {
        height:600px;
        width:600px;
    }

    .container {
      margin-left: 0;
      margin-right: 0;
    }

</style>

{% endblock %}

{% block content %}

<input type='hidden' id='user_lat' value="{{ userLat }}">
<input type='hidden' id='user_lon' value="{{ userLon }}">

<input type='hidden' id='airport_lat' value="{{ airport_obj.lattitude }}">
<input type='hidden' id='airport_lng' value="{{ airport_obj.longitude }}">

<input type='hidden' id='rec_lat' value="{{ rec_lat }}">
<input type='hidden' id='rec_lng' value="{{ rec_lng }}">

<input type='hidden' id='sunset-time' value='{{ sunset_str }}'>
<input type='hidden' id='current-time' value='{{ current_time_str }}'>


<div class='container'>
  <div class = 'row'>
    <div class='col-xs-5'>
      <h1> Here is my prediction: </h1>
      <p> (for {{ day }}'s sunset) </p>

      <h2> {{ description }} </h2>

      CURRENT TIME: <p id='current-time-display'> </p>
      SUNSET TIME:   <p id="sunset-time-display"> </p>

      <p>Location of closest forecast: ({{ distance_to_closest }} km away) <br>
      {{ airport_obj.airport_name }}<br>
      {{ airport_obj.icao_code }}<br>
      </p>

      <p>
          {{rec_message}}
          {% if rec_forecast != 'same' %}
             ({{ distance_to_rec }} km away)
          {% endif %}
      </p>
    </div>  


    <div id='map' class='col-xs-6'></div>
  </div>
</div>
<script src="https://code.jquery.com/jquery.js"></script>



<script type="text/javascript">


let sunsetTime = $('#sunset-time').val();
let currentTime = $('#current-time').val();

let sunsetTimeDisplay = $('#sunset-time-display');
let currentTimeDisplay = $('#current-time-display');

let sDate = new Date(sunsetTime);
let cDate = new Date(currentTime);

//TO DO:
//Come back to this using a javascript library such as 'moments' to find the 
//actual time zone instead of just stripping the string

let sTimeZoneStr = sDate.toString()
sTimeZoneStr = sTimeZoneStr.slice(sTimeZoneStr.length - 4, sTimeZoneStr.length - 1);
let cTimeZoneStr = cDate.toString()
cTimeZoneStr = cTimeZoneStr.slice(cTimeZoneStr.length - 4, cTimeZoneStr.length - 1);

let sDateTxt = sDate.getHours()+":"+sDate.getMinutes()+":"+sDate.getSeconds()+" "+sTimeZoneStr;
let cDateTxt = cDate.getHours()+":"+cDate.getMinutes()+":"+cDate.getSeconds()+" "+cTimeZoneStr;

sunsetTimeDisplay.html(sDateTxt);
currentTimeDisplay.html(cDateTxt);


function initMap() {
    let user_lat = parseFloat($('#user_lat').val())
    let user_lon = parseFloat($('#user_lon').val())

    let airportLat = parseFloat($('#airport_lat').val())
    let airportLng = parseFloat($('#airport_lng').val())

    let recLat = $('#rec_lat').val()
    let recLng = $('#rec_lng').val()




    let yourPosition = {lat: user_lat, lng: user_lon};
        console.log(yourPosition)

    let map = new google.maps.Map(document.querySelector('#map'), {
        center: yourPosition,
        zoom: 11,
    });

    let marker = new google.maps.Marker({
        position: yourPosition,
        map: map,
        title: 'Chosen Location'

    });


    let airportPosition = {lat: airportLat, lng: airportLng}
        console.log(airportPosition)

    let airportMarker = new google.maps.Marker({
        position: airportPosition,
        map: map,
        title: 'Forecast Location'
    });

    if (recLat !== 'None') {
        recLat = parseFloat(recLat)
        recLng = parseFloat(recLng)

        let recPosition = {lat: recLat, lng: recLng};

        let recMarker = new google.maps.Marker({
            position: recPosition,
            map: map,
            title: 'Recommended Location'
        });
    }
    
    initAutocomplete();
}



</script>
<script src="{{ mapsapiurl }}"
async defer></script>





{% endblock %}