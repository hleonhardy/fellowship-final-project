{% extends 'base.html' %}
{% block title %} Sunset Prediction {% endblock %}
{% block style %}

<style type="text/css">

    #map {
        height:600px;
        width:600px;

        
    }

    body, html {
      overflow: hidden;
    }

    #col-content{
      padding-top: 100px;
    }

    .row {
      padding-top: 20px;
    }

    .scroll {
      background-color: white;
/*      text-align: center;*/
      height:75%;
/*      position: absolute;*/
      top: 0px;
      bottom: 0;
      left: 0;
/*      width: 75%;*/
      overflow-y: scroll;
      direction: rtl;
    }

    .scroll-text{
      direction: ltr;
      padding-left: 20px;
    }



</style>

{% endblock %}

{% block content %}

<input type='hidden' id='user_lat' value="{{ userLat }}">
<input type='hidden' id='user_lon' value="{{ userLon }}">

<input type='hidden' id='airport_lat' value="{{ airport_obj.lattitude }}">
<input type='hidden' id='airport_lng' value="{{ airport_obj.longitude }}">

<input type='hidden' id='rec_lat' value="{{ rec_lat }}">
<input type='hidden' id='rec_lng' value="{{ rec_lng }}">

<input type='hidden' id='sunset-time' value='{{ sunset_str }}'>
<input type='hidden' id='current-time' value='{{ current_time_str }}'>


<div class='container'>
  <div class = 'row'>
    <div class='col-xs-6 scroll' id="col-content">
      <div class='scroll-text'>
        <h1> Here is my prediction: </h1>
        <p> (for {{ day }}'s sunset) </p>

        <h2> {{ description }} </h2>

        Local Timezone: {{local_tz}}<br>
        CURRENT TIME: {{local_time}}<br>
        <!-- <p id='current-time-display'> </p> -->
        SUNSET TIME ({{ day }}): {{local_sunset_time}} <br>
        <!-- <p id="sunset-time-display"> </p> -->
        <br>
        <p>Location of closest forecast: ({{ distance_to_closest }} km away) <br>
        {{ airport_obj.airport_name }}<br>
        {{ airport_obj.icao_code }}<br>
        </p>

        <p>
            <h3>{{rec_message}}</h3>
            {% if rec_forecast != 'same' %}
               ({{ distance_to_rec }} km away)<br>

               <h3>Forecast: {{rec_desc}}</h3>
            {% endif %}
        </p>
        <br>
        ranked recommendations:<br>
        <div>
        {% for rating_dict in sorted_forecast_ratings %}
            {{ rating_dict['rank'] }} | {{ rating_dict['icao'] }}<br>
        {% endfor %}

        <br><br><br>
      </div>
    </div>

    </div>  


    <div class='col-xs-6'>
      <div id='map'> 
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery.js"></script>



<script type="text/javascript">



function initMap() {
  // console.log(lat, lng)
    let user_lat = parseFloat($('#user_lat').val())
    let user_lon = parseFloat($('#user_lon').val())

    let airportLat = parseFloat($('#airport_lat').val())
    let airportLng = parseFloat($('#airport_lng').val())

    let recLat = $('#rec_lat').val()
    let recLng = $('#rec_lng').val()

    let bounds;

    let yourPosition = {lat: user_lat, lng: user_lon};
        console.log(yourPosition)

    let airportPosition = {lat: airportLat, lng: airportLng}
        console.log(airportPosition)


    bounds = new google.maps.LatLngBounds();

    let map = new google.maps.Map(document.querySelector('#map'), {
        center: yourPosition
        // zoom: 11,
    });

    let marker = new google.maps.Marker({
        position: yourPosition,
        map: map,
        title: 'Chosen Location'
    });

    // let airportMarker = new google.maps.Marker({
    //     position: airportPosition,
    //     map: map,
    //     title: 'Forecast Location',
    //     // icon: 'http://boothamphitheatre.com/wp-content/uploads/2016/02/dc6o4KBc9.png'
    // });


    // let airportLoc = new google.maps.LatLng(airportMarker.position.lat(), airportMarker.position.lng());
    // bounds.extend(airportLoc);

    if (recLat !== 'None') {
        recLat = parseFloat(recLat)
        recLng = parseFloat(recLng)

        let recPosition = {lat: recLat, lng: recLng};

        let recMarker = new google.maps.Marker({
            position: recPosition,
            map: map,
            title: 'Recommended Location'
        });

        recLoc = new google.maps.LatLng(recMarker.position.lat(), recMarker.position.lng());
        bounds.extend(recLoc);
        
        let usrLoc = new google.maps.LatLng(marker.position.lat(), marker.position.lng());
        bounds.extend(usrLoc);
        map.fitBounds(bounds)
    }

    if (recLat == 'None'){
      map.setZoom(12);
    }

    
    initAutocomplete();
}



</script>
<script src="{{ mapsapiurl }}"
async defer></script>





{% endblock %}