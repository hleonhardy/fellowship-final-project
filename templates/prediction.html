{% extends 'base.html' %}
{% block title %} Sunset Prediction {% endblock %}
{% block style %}

<style type="text/css">

    #map {
        height:600px;
        width:600px;
    }

</style>

{% endblock %}

{% block content %}

<input type='hidden' id='user_lat' value="{{ userLat }}">
<input type='hidden' id='user_lon' value="{{ userLon }}">

<input type='hidden' id='airport_lat' value="{{ airport_obj.lattitude }}">
<input type='hidden' id='airport_lng' value="{{ airport_obj.longitude }}">

<input type='hidden' id='rec_lat' value="{{ rec_lat }}">
<input type='hidden' id='rec_lng' value="{{ rec_lng }}">



<h1> Here is my prediction: </h1>

<h2> {{ description }} </h2>

<p> SUNSET TIME: {{sunset_time}} UTC </p>
<p> CURRENT TIME: {{ current_utc.time()}} UTC

<p>
{{ airport_obj.icao_code }}<br>
{{ airport_obj.airport_name }}<br>
</p>

<p>

    
    {{forecast['timestamp']['forecast_from']}}<br>
    {{forecast['timestamp']['forecast_to']}}<br>
    {{forecast['clouds']}}<br><br>


    {{rec_message}}
    {% if rec_forecast != 'same' %}
        Here is the forecast for {{ rec_forecast['icao'] }}:<br>
        {{ rec_forecast['clouds'] }}

    {% endif %}

</p>

<!-- Trying to get the map to work: -->

<div id='map'></div>
<script src="https://code.jquery.com/jquery.js"></script>



<script type="text/javascript">
function initMap() {
    let user_lat = parseFloat($('#user_lat').val())
    let user_lon = parseFloat($('#user_lon').val())

    let airportLat = parseFloat($('#airport_lat').val())
    let airportLng = parseFloat($('#airport_lng').val())

    let recLat = $('#rec_lat').val()
    let recLng = $('#rec_lng').val()




    let yourPosition = {lat: user_lat, lng: user_lon};
        console.log(yourPosition)

    let map = new google.maps.Map(document.querySelector('#map'), {
        center: yourPosition,
        zoom: 11,
    });

    let marker = new google.maps.Marker({
        position: yourPosition,
        map: map,
        title: 'Chosen Location'

    });


    let airportPosition = {lat: airportLat, lng: airportLng}
        console.log(airportPosition)

    let airportMarker = new google.maps.Marker({
        position: airportPosition,
        map: map,
        title: 'Forecast Location'
    });

    if (recLat !== 'None') {
        recLat = parseFloat(recLat)
        recLng = parseFloat(recLng)

        let recPosition = {lat: recLat, lng: recLng};

        let recMarker = new google.maps.Marker({
            position: recPosition,
            map: map,
            title: 'Recommended Location'
        });
    }
    
    initAutocomplete();
}


</script>
<script src="{{ mapsapiurl }}"
async defer></script>





{% endblock %}